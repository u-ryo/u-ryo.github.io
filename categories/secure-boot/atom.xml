<?xml version="1.0" encoding="utf-8"?><feed xmlns="http://www.w3.org/2005/Atom"><title><![CDATA[u-ryo's blog]]></title><link href="/categories/secure-boot/atom.xml" rel="self"/><link href="/"/><updated>2015-10-27T08:26:47+00:00</updated><id>/</id><author><name><![CDATA[u-ryo]]></name></author><generator uri="http://sysgears.com/grain/">Grain</generator><entry><title type="html"><![CDATA[Secure Boot]]></title><link href="/blog/2015/11/04/secure-boot/"/><updated>2015-11-04T02:18:08+00:00</updated><id>/blog/2015/11/04/secure-boot/</id><content type="html"><![CDATA[<p>Linux (ubuntu)でSecure Bootを求められました。
ubuntuには、Linux-signed-imageとかgrub-efi-amd64-signedとかっていう
パッケージがあるので、何か出来そうなんですけど、
じゃ具体的にどうやるの?
というのは意外と書いてないので、苦労してます。</p>
<p>取り敢えず、grub-installで「--secure-boot」というオプションがあるので、</p>
<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='html'><span class='line'>$ sudo grub-install --force --no-floppy --efi-directory=/mnt/ --target=x86_64-efi --uefi-secure-boot /dev/sdb
</span></code></pre></td></tr></table></div></figure>
<p>とすると、USBメモリには、/mnt/EFI/ubuntu/ の下にsignedなgrubx64.efiやshimx64.efiが入るんですが、
/EFI/ubuntu/... ではブート時に読み込まないので、
/EFI/BOOT/ にリネームし、
また、/EFI/BOOT/grubx64.efi(又はshimx64.efi) を/EFI/BOOT/BOOTX64.efi にリネームし、
/boot/grub/grub.cfg を、</p>
<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
</pre></td><td class='code'><pre><code class='html'><span class='line'>set timeout=3
</span><span class='line'>set default=0
</span><span class='line'>
</span><span class='line'>menuentry &quot;Run Ubuntu Live ISO&quot; {
</span><span class='line'>       set gfxpayload=keep
</span><span class='line'>       loopback loop (hd0,gpt1)/airscope3.iso
</span><span class='line'>       linux (loop)/casper/vmlinuz boot=casper iso-scan/filename=/airscope3.iso splash --- debian-installer/language=ja keyboard-configuration/layoutcode?=jp keyboard-configuration/modelcode?=jp109
</span><span class='line'>       initrd (loop)/casper/initrd.lz
</span><span class='line'>}
</span></code></pre></td></tr></table></div></figure>
<p>とすると、grubまでは立ち上がりました。
更にブートするには、loopbackモジュールが必要になり、
それはunsignedなので、そこで引っ掛かりますが、
仕組み上、signed grubでモジュールは使えない(使えてしまうとillegalなモジュールが入り込めてしまう)ので、
1. loopbackモジュールを使わない
1. loopbackモジュールを含めたgrubを自力で署名する
前者はUSBメモリをHDとして直接インストールすれば良さそうですが、
8GB以上の容量が必要になります。
現状手元にそんな容量のUSBメモリがありません。
後者は、かなり面倒そうです。Micro$osftに署名してもらうにはお金かかりそうですし、
自分で署名してそのキーをMOK?を使って云々という手法は、
まだ読み込んでません...</p>
]]></content></entry></feed>