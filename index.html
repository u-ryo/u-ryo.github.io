<!DOCTYPE html> <!--[if IEMobile 7 ]><html class="no-js iem7"><![endif]--> <!--[if lt IE 9]><html class="no-js lte-ie8"><![endif]--> <!--[if (gt IE 8)|(gt IEMobile 7)|!(IEMobile)|!(IE)]><!--><html class="no-js" lang="en"><!--<![endif]--> <head> <meta charset="utf-8"> <title>u-ryo's blog</title> <meta name="author" content="u-ryo"> <meta name="HandheldFriendly" content="True"> <meta name="MobileOptimized" content="320"> <meta name="viewport" content="width=device-width, initial-scale=1"> <link rel="canonical" href="http://u-ryo.github.io//"> <link href="/images/favicon-eec3051d5c356d1798bea1d8a3617c51.png" rel="icon"> <link href="/stylesheets/screen-212a3205d97b53ef71581e910c98f79c.css" media="screen, projection" rel="stylesheet" type="text/css"> <link href="atom.xml" rel="alternate" title="u-ryo's blog" type="application/atom+xml"> <script src="/javascripts/libs/jquery.min-663628f795cb62444143fde1ebdf2b5b.js" type="text/javascript"></script> <script src="/javascripts/modernizr-2.0-f86b862d5ee138da61daf47f24116ed7.js" type="text/javascript"></script> <script src="/javascripts/octopress-52bd0860c81b8af484852d75380d38f3.js" type="text/javascript"></script> <script src="/javascripts/github-2c23ec60bbc7e962f6324b25d8b2ae44.js" type="text/javascript"></script> <script src="/javascripts/jquery.tweet-408e79928ca077df30b72fe36df5754e.js" type="text/javascript"></script> <script src="/javascripts/twitter-options-084da5e02b1a45f2ea5ec905be775075.js" type="text/javascript"></script> <script type="text/javascript">
    var _gaq = _gaq || [];
    _gaq.push(['_setAccount', 'UA-70134374-1']);
    _gaq.push(['_trackPageview']);

    (function() {
      var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
      ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
      var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
    })();
  </script> <link href="http://fonts.googleapis.com/css?family=PT+Serif:regular,italic,bold,bolditalic" rel="stylesheet" type="text/css"> <link href="http://fonts.googleapis.com/css?family=PT+Sans:regular,italic,bold,bolditalic" rel="stylesheet" type="text/css"> </head> <body> <header role="banner"><hgroup> <h1><a href="/">u-ryo's blog</a></h1> <h2>various information for coding...</h2> </hgroup> </header> <nav role="navigation"><ul class="subscription" data-subscription="rss "> <li><a href="http://u-ryo.github.io//atom.xml" rel="subscribe-rss" title="subscribe via RSS">RSS</a></li> </ul> <form action="http://google.com/search" method="get"> <fieldset role="search"> <input type="hidden" name="sitesearch" value="http://u-ryo.github.io/"/> <input class="search" type="text" name="q" results="0" placeholder="Search"/> </fieldset> </form> <ul class="main-navigation"> <li><a href="/">Blog</a></li> <li><a href="/archives/">Archives</a></li> </ul> </nav> <div id="main"> <div id="content"> <div class="blog-index"> <article> <article> <header> <h1 class="entry-title"><a href="/blog/2023/09/10/get-refresh-token-for-google-api/">Get Refresh Token for Google API</a></h1> <p class="meta"> <time datetime="2023-09-10T15:03:00+09:00" pubdate data-updated=true> <span class="month">Sep</span> <span class="day">10</span>, <span class="year">2023</span> </time> | <a href="http://u-ryo.github.io//blog/2023/09/10/get-refresh-token-for-google-api/#disqus_thread">Comments</a> </p> </header> <div class="entry-content">ä½•ã‹ã„ã¤ã®é–“ã«ã‹Google APIã®èªè¨¼æ–¹æ³•ãŒå¤‰ã‚ã£ã¦ã¦ã€securityä¸Šã®ç†ç”±ã‹ã‚‰ã¨ã„ã†ã®ã§ä»•æ–¹ãªã„ã‚“ã§ã—ã‚‡ã†ã‘ã©ã€‚ `AUTHORIZATION_CODE`ã‚’å¾—ã‚ˆã†ã¨ã€ä»¥å‰ã®ã‚ˆã†ã«â†“ã®URLã«accessã™ã‚‹ã¨ã€ https://accounts.google.com/o/oauth2/v2/auth?response_type=code&client_id=...apps.googleusercontent.com&redirect_uri=urn:ietf:wg:oauth:2.0:oob&scope=https://www.googleapis.com/auth/photoslibrary&access_type=offline `ã‚¢ã‚¯ã‚»ã‚¹ã‚’ãƒ–ãƒ­ãƒƒã‚¯: ... ã®ãƒªã‚¯ã‚¨ã‚¹ãƒˆã¯ç„¡åŠ¹ã§ã™` ã¨å‡ºã¦ã€ã‚ã‚Œ?!ã¨ã€‚ > ã‚¨ãƒ©ãƒ¼ 400: invalid_request > The out-of-band (OOB) flow has been blocked in order to keep users secure. Follow the Out-of-Band (OOB) flow migration guide linked in the developer docs below to migrate your app to an alternative method. ã§ã€[å¸¯åŸŸå¤–ï¼ˆOOBï¼‰ãƒ•ãƒ­ãƒ¼ç§»è¡Œã‚¬ã‚¤ãƒ‰](https://developers.google.com/identity/protocols/oauth2/resources/oob-migration?hl=ja)ã¸èª˜å°ã•ã‚Œã€‚ ã“ã®oobãƒ•ãƒ­ãƒ¼ã¯ãªããªã£ãŸã¨!? ã‚“ã˜ã‚ƒã©ã†ã›ãƒã£ã¦ã„ã†ã‚“ã˜ã‚ƒã­ã‚“ã€‚ ã€Œãƒ‡ã‚¹ã‚¯ãƒˆãƒƒãƒ—ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆã€ã«ç›¸å½“ã™ã‚‹ã‹ã‚‰ã€[ãƒ«ãƒ¼ãƒ—ãƒãƒƒã‚¯ IP ã‚¢ãƒ‰ãƒ¬ã‚¹ï¼ˆlocalhost ã¾ãŸã¯ 127.0.0.1ï¼‰ãƒ•ãƒ­ãƒ¼](https://developers.google.com/identity/protocols/oauth2/native-app?hl=ja#redirect-uri_loopback)ã«é£›ã°ã•ã‚ŒãŸã‚‚ã®ã®ã€ã“ã£ã¡ã‚‚ãªããªã£ã¦ã¦ã€[ãƒ«ãƒ¼ãƒ—ãƒãƒƒã‚¯ IP ã‚¢ãƒ‰ãƒ¬ã‚¹ãƒ•ãƒ­ãƒ¼ã®ç§»è¡Œã‚¬ã‚¤ãƒ‰](https://developers.google.com/identity/protocols/oauth2/resources/loopback-migration?hl=ja)ã«é£›ã°ã•ã‚Œã¦ã€çµå±€libraryä½¿ã†æ–¹æ³•ã—ã‹æ›¸ã„ã¦ãªãã¦ã€‚ã“ã¡ã¨ã‚‰ã€shell scriptã§ä½¿ã„ãŸã„ã‚“ã§ã™ã‘ã©ã€‚`refresh_token`æ¬²ã—ã„ã ã‘ãªã®ã«ã€ãªã‚“ã§ã“ã‚“ãªã«è‹¦åŠ´ã›ãªã‹ã‚“ã®??ğŸ¤” ...ã£ã¦å˜†ã„ã¦ã‚‚ä»•æ–¹ãªã„ã®ã§ã€libraryä½¿ã£ã¦`refresh_token`å–å¾—ã ã‘ã—ã¾ã™ã€‚ ã¡ã‚‡ã£ã¨ã‚ã‚“ã©ãã•ã„ã‚“ã§ã™ã‘ã©ã€localç’°å¢ƒã‚’æ±šæŸ“ã—ãªã„å½¢ã§ã€‚ å‚è€ƒ: - [Pythonã‹ã‚‰GooglePhotoã«ç”»åƒã‚„å‹•ç”»ã‚’ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰](https://qiita.com/sey323/items/4c7140efaed750e690eb) - [Pythonã‹ã‚‰GoogleDriveã«ãƒ•ã‚¡ã‚¤ãƒ«ã‚’ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰](https://qiita.com/sey323/items/875c0ab1585044772ab2#%E8%AA%8D%E8%A8%BC%E6%83%85%E5%A0%B1%E3%81%AE%E4%BD%9C%E6%88%90) Google APIã®[èªè¨¼æƒ…å ±ã®page](https://console.cloud.google.com/apis/credentials)ã‹ã‚‰ã€ŒOAuthã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆã‚’ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰ã€ã—ã¦`client_secret.json`ã¨ã—ã¦ä¿å­˜ã€‚ nullsh $ docker run --rm -it -v $PWD/client_secret_....json:/root/client_secret.json python:alpine sh # apk add w3m screen # pip install google-api-python-client google-auth-oauthlib # screen # python >>> from google_auth_oauthlib.flow import InstalledAppFlow >>> credential=InstalledAppFlow.from_client_secrets_file('client_secret.json',["https://www.googleapis.com/auth/photoslibrary.appendonly"]).run_local_server() null ã“ã“ã§`w3m`ãŒé–‹ãã®ã§ã€`Q`ã‚’æŠ¼ã—ã¦é–‰ã˜ã‚‹ã¨URLãŒè¡¨ç¤ºã•ã‚Œã€ãã“ã‚’Chromeãªã‚Šã§é–‹ã„ã¦ã€çªãé€²ã‚“ã§æ‰¿èªã—ã¾ã™ã€‚ ãã†ã™ã‚‹ã¨ã€http://localhost:8080/?state=.... ã¸å›ã•ã‚Œã¦æ­¢ã¾ã‚‹ã®ã§ã€`C-a`ã§åˆ¥screenã‚’é–‹ã„ã¦ã€ãã“ã§`w3m 'http://localhost:8080/?state=...'`ã¨ã™ã‚‹ã¨ã€`The authentication flow has completed. You may close this window.`ã¨è¨€ã‚ã‚Œã¾ã™ã€‚å¾ã«å…ƒã®screenã«æˆ»ã‚‹ã¨`credential` objectãŒã§ãã¦ã„ã‚‹ã®ã§ã€`credential.refresh_token`ã¨ã™ã‚‹ã¨ã€æ¼¸ã`REFRESH_TOKEN`ã‚’å¾—ã‚‰ã‚Œã¾ã™ã€‚1æ™‚é–“æœ‰åŠ¹ãª`ACCESS_TOKEN`ã¯`credentail.token`ã§å¾—ã‚‰ã‚Œã¾ã™ã€‚ ã“ã‚Œã‚‰ã‚’ä½¿ã†ã¨ã€ã‚„ã£ã¨ä»¥å‰ã®ã‚ˆã†ã«shell scriptã§å›ã›ã‚‹ã‚ˆã†ã«ãªã‚Šã¾ã™ã€‚ãµã…ã€‚ </div> </article> <article> <header> <h1 class="entry-title"><a href="/blog/2023/09/10/get-refresh-token-for-google-api/">Get Refresh Token for Google API</a></h1> <p class="meta"> <time datetime="2023-09-10T15:03:00+09:00" pubdate data-updated=true> <span class="month">Sep</span> <span class="day">10</span>, <span class="year">2023</span> </time> | <a href="http://u-ryo.github.io//blog/2023/09/10/get-refresh-token-for-google-api/#disqus_thread">Comments</a> </p> </header> <div class="entry-content"><p>ä½•ã‹ã„ã¤ã®é–“ã«ã‹Google APIã®èªè¨¼æ–¹æ³•ãŒå¤‰ã‚ã£ã¦ã¦ã€securityä¸Šã®ç†ç”±ã‹ã‚‰ã¨ã„ã†ã®ã§ä»•æ–¹ãªã„ã‚“ã§ã—ã‚‡ã†ã‘ã©ã€‚</p> <p><code>AUTHORIZATION_CODE</code>ã‚’å¾—ã‚ˆã†ã¨ã€ä»¥å‰ã®ã‚ˆã†ã«â†“ã®URLã«accessã™ã‚‹ã¨ã€ https://accounts.google.com/o/oauth2/v2/auth?response<em>type=code&amp;client</em>id=...apps.googleusercontent.com&amp;redirect<em>uri=urn:ietf:wg:oauth:2.0:oob&amp;scope=https://www.googleapis.com/auth/photoslibrary&amp;access</em>type=offline <code>ã‚¢ã‚¯ã‚»ã‚¹ã‚’ãƒ–ãƒ­ãƒƒã‚¯: ... ã®ãƒªã‚¯ã‚¨ã‚¹ãƒˆã¯ç„¡åŠ¹ã§ã™</code></p> <p>ã¨å‡ºã¦ã€ã‚ã‚Œ?!ã¨ã€‚</p> <blockquote><p>ã‚¨ãƒ©ãƒ¼ 400: invalid_request The out-of-band (OOB) flow has been blocked in order to keep users secure. Follow the Out-of-Band (OOB) flow migration guide linked in the developer docs below to migrate your app to an alternative method.</p> </blockquote> <p>ã§ã€<a href="https://developers.google.com/identity/protocols/oauth2/resources/oob-migration?hl=ja">å¸¯åŸŸå¤–ï¼ˆOOBï¼‰ãƒ•ãƒ­ãƒ¼ç§»è¡Œã‚¬ã‚¤ãƒ‰</a>ã¸èª˜å°ã•ã‚Œã€‚</p> <p>ã“ã®oobãƒ•ãƒ­ãƒ¼ã¯ãªããªã£ãŸã¨!? ã‚“ã˜ã‚ƒã©ã†ã›ãƒã£ã¦ã„ã†ã‚“ã˜ã‚ƒã­ã‚“ã€‚</p> <p>ã€Œãƒ‡ã‚¹ã‚¯ãƒˆãƒƒãƒ—ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆã€ã«ç›¸å½“ã™ã‚‹ã‹ã‚‰ã€<a href="https://developers.google.com/identity/protocols/oauth2/native-app?hl=ja#redirect-uri_loopback">ãƒ«ãƒ¼ãƒ—ãƒãƒƒã‚¯ IP ã‚¢ãƒ‰ãƒ¬ã‚¹ï¼ˆlocalhost ã¾ãŸã¯ 127.0.0.1ï¼‰ãƒ•ãƒ­ãƒ¼</a>ã«é£›ã°ã•ã‚ŒãŸã‚‚ã®ã®ã€ã“ã£ã¡ã‚‚ãªããªã£ã¦ã¦ã€<a href="https://developers.google.com/identity/protocols/oauth2/resources/loopback-migration?hl=ja">ãƒ«ãƒ¼ãƒ—ãƒãƒƒã‚¯ IP ã‚¢ãƒ‰ãƒ¬ã‚¹ãƒ•ãƒ­ãƒ¼ã®ç§»è¡Œã‚¬ã‚¤ãƒ‰</a>ã«é£›ã°ã•ã‚Œã¦ã€çµå±€libraryä½¿ã†æ–¹æ³•ã—ã‹æ›¸ã„ã¦ãªãã¦ã€‚ã“ã¡ã¨ã‚‰ã€shell scriptã§ä½¿ã„ãŸã„ã‚“ã§ã™ã‘ã©ã€‚<code>refresh_token</code>æ¬²ã—ã„ã ã‘ãªã®ã«ã€ãªã‚“ã§ã“ã‚“ãªã«è‹¦åŠ´ã›ãªã‹ã‚“ã®??ğŸ¤”</p> <p>...ã£ã¦å˜†ã„ã¦ã‚‚ä»•æ–¹ãªã„ã®ã§ã€libraryä½¿ã£ã¦<code>refresh_token</code>å–å¾—ã ã‘ã—ã¾ã™ã€‚</p> <p>ã¡ã‚‡ã£ã¨ã‚ã‚“ã©ãã•ã„ã‚“ã§ã™ã‘ã©ã€localç’°å¢ƒã‚’æ±šæŸ“ã—ãªã„å½¢ã§ã€‚</p> <p>å‚è€ƒ:</p> <ul> <li><a href="https://qiita.com/sey323/items/4c7140efaed750e690eb">Pythonã‹ã‚‰GooglePhotoã«ç”»åƒã‚„å‹•ç”»ã‚’ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰</a></li> <li><a href="https://qiita.com/sey323/items/875c0ab1585044772ab2#%E8%AA%8D%E8%A8%BC%E6%83%85%E5%A0%B1%E3%81%AE%E4%BD%9C%E6%88%90">Pythonã‹ã‚‰GoogleDriveã«ãƒ•ã‚¡ã‚¤ãƒ«ã‚’ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰</a></li> </ul> <p>Google APIã®<a href="https://console.cloud.google.com/apis/credentials">èªè¨¼æƒ…å ±ã®page</a>ã‹ã‚‰ã€ŒOAuthã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆã‚’ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰ã€ã—ã¦<code>client_secret.json</code>ã¨ã—ã¦ä¿å­˜ã€‚</p> <figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
</pre></td><td class='code'><pre><code class='sh'><span class='line'><span class="nv">$ </span>docker run --rm -it -v <span class="nv">$PWD</span>/client_secret_....json:/root/client_secret.json python:alpine sh
</span><span class='line'><span class="c"># apk add w3m screen</span>
</span><span class='line'><span class="c"># pip install google-api-python-client google-auth-oauthlib</span>
</span><span class='line'><span class="c"># screen</span>
</span><span class='line'><span class="c"># python</span>
</span><span class='line'>&gt;&gt;&gt; from google_auth_oauthlib.flow import InstalledAppFlow
</span><span class='line'>&gt;&gt;&gt; <span class="nv">credential</span><span class="o">=</span>InstalledAppFlow.from_client_secrets_file<span class="o">(</span><span class="s1">&#39;client_secret.json&#39;</span>,<span class="o">[</span><span class="s2">&quot;https://www.googleapis.com/auth/photoslibrary.appendonly&quot;</span><span class="o">])</span>.run_local_server<span class="o">()</span>
</span></code></pre></td></tr></table></div></figure> <p>ã“ã“ã§<code>w3m</code>ãŒé–‹ãã®ã§ã€<code>Q</code>ã‚’æŠ¼ã—ã¦é–‰ã˜ã‚‹ã¨URLãŒè¡¨ç¤ºã•ã‚Œã€ãã“ã‚’Chromeãªã‚Šã§é–‹ã„ã¦ã€çªãé€²ã‚“ã§æ‰¿èªã—ã¾ã™ã€‚</p> <p>ãã†ã™ã‚‹ã¨ã€http://localhost:8080/?state=.... ã¸å›ã•ã‚Œã¦æ­¢ã¾ã‚‹ã®ã§ã€<code>C-a</code>ã§åˆ¥screenã‚’é–‹ã„ã¦ã€ãã“ã§<code>w3m 'http://localhost:8080/?state=...'</code>ã¨ã™ã‚‹ã¨ã€<code>The authentication flow has completed. You may close this window.</code>ã¨è¨€ã‚ã‚Œã¾ã™ã€‚å¾ã«å…ƒã®screenã«æˆ»ã‚‹ã¨<code>credential</code> objectãŒã§ãã¦ã„ã‚‹ã®ã§ã€<code>credential.refresh_token</code>ã¨ã™ã‚‹ã¨ã€æ¼¸ã<code>REFRESH_TOKEN</code>ã‚’å¾—ã‚‰ã‚Œã¾ã™ã€‚1æ™‚é–“æœ‰åŠ¹ãª<code>ACCESS_TOKEN</code>ã¯<code>credentail.token</code>ã§å¾—ã‚‰ã‚Œã¾ã™ã€‚</p> <p>ã“ã‚Œã‚‰ã‚’ä½¿ã†ã¨ã€ã‚„ã£ã¨ä»¥å‰ã®ã‚ˆã†ã«shell scriptã§å›ã›ã‚‹ã‚ˆã†ã«ãªã‚Šã¾ã™ã€‚ãµã…ã€‚</p> </div> </article> <article> <header> <h1 class="entry-title"><a href="/blog/2022/03/20/nhk-taiga-staff-reflection/">NHK Taiga Staff Reflection</a></h1> <p class="meta"> <time datetime="2022-03-20T21:23:00+09:00" pubdate data-updated=true> <span class="month">Mar</span> <span class="day">20</span>, <span class="year">2022</span> </time> | <a href="http://u-ryo.github.io//blog/2022/03/20/nhk-taiga-staff-reflection/#disqus_thread">Comments</a> </p> </header> <div class="entry-content"><p><a href="https://matomebu.com/wadai/kamakura13jiko20220313/">å¤§æ²³ãƒ‰ãƒ©ãƒã€éŒå€‰æ®¿ã®13äººã€13æ—¥æ”¾é€åˆ†ã«ä¸€çœ¼ã‚«ãƒ¡ãƒ©ã‚’æ§‹ãˆãŸãƒã‚¹ã‚¯ãŠã˜ã•ã‚“ã‚¹ã‚¿ãƒƒãƒ•æ˜ ã‚Šè¾¼ã¿æ”¾é€äº‹æ•…ã§å…¬å¼ãŒè¬ç½ªã€è¦–è´è€…ã€Œã‚¿ã‚¤ãƒ ã‚¹ã‚¯ãƒ¼ãƒ—ãƒãƒ³ã‚¿ãƒ¼ã®æ’®å½±ç­ã ã€#éŒå€‰æ®¿ã®13äºº</a> ãŸã¾ãŸã¾ã¼ãã‚‚æœ¬æ”¾é€ã€å†æ”¾é€ã©ã¡ã‚‰ã‚‚éŒ²ç”»ã—ã¦ãŸã®ã§ã€ã‚ˆãƒ¼ãè¦‹ã¦ã¿ã¾ã—ãŸã€‚</p> <p><img src="kamakuradonono13nin.png" alt="kamakuradonono13nin"/></p> <p>12fps ã§ 3ã‚³ãƒç´„0.2ç§’ã€ç¢ºã‹ã«ã‚ˆãè¦‹ä»˜ã‘ãŸãªãã¨æ€ã„ã¾ã™ã€‚ å†æ”¾é€ã§ã¯ç·¨é›†ã•ã‚Œã‚‹ã¨ã®ç”±ã€ã©ã†ãªã‚‹ã‚“ã ã‚ã†ã¨æ³¨è¦–ã—ã¦ã„ã¾ã—ãŸã‚‰ã€ åŒ—æ¡ç¾©æ™‚ã®èµ°ã‚‹ã‚·ãƒ¼ãƒ³ãŒä¾‹ã®å ´é¢ç›´å‰ã¾ã§ã§ã‚«ãƒƒãƒˆã•ã‚Œã€ ãã®åˆ†ä½ç«¹å´ã®æ­¦è€…é”ãŒé™ã‚Šã¦ãã‚‹æ¬¡ã®ã‚·ãƒ¼ãƒ³ãŒè‹¥å¹²é•·ããªã£ã¦ã„ã‚‹ã€ ã¨ã„ã†ã‚‚ã®ã§ã—ãŸã€‚ ä¸¡è€…è¶³ã—ãŸã‚‚ã®ã‚’ä½œã£ã¦ã¿ãŸã‚‰ç¢ºã‹ã«45åˆ†ã‚’0.2ç§’ç¨‹è¶Šãˆã¦ã¾ã—ãŸã€‚</p> </div> </article> <article> <header> <h1 class="entry-title"><a href="/blog/2021/07/11/gradlew-stopped/">Gradlew Stopped</a></h1> <p class="meta"> <time datetime="2021-07-11T01:02:00+09:00" pubdate data-updated=true> <span class="month">Jul</span> <span class="day">11</span>, <span class="year">2021</span> </time> | <a href="http://u-ryo.github.io//blog/2021/07/11/gradlew-stopped/#disqus_thread">Comments</a> </p> </header> <div class="entry-content"><p>å®Ÿã«ä¹…ã—æŒ¯ã‚Šã«ã“ã®blogã‚’æ›¸ã“ã†ã¨ã—ã¦ã€</p> <figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='html'><span class='line'>./grainw create-post &#39;some title&#39;
</span></code></pre></td></tr></table></div></figure> <p>ã¨ã—ãŸã‚‰ã€<code>gradle-1.8.jar</code>ã‚’å–ã‚Šã«è¡Œã£ã¦404 not foundé£Ÿã‚‰ã£ã¦å‹•ãã¾ã›ã‚“ã€‚ ã“ã®<a href="https://github.com/sysgears/grain">grain</a>ã£ã¦å¤ã„ã—ã‚‚ã†æ›´æ–°æ­¢ã¾ã£ã¦ã‚‹ã—ã€å…ˆè¦‹ã®æ˜ãªã‹ã£ãŸãªãã¨ã„ã†ã“ã¨ãªã‚“ã§ã™ãŒã€ã‚‚ã†ã¡ã‚‡ã£ã¨æœ¬æ°—ã§åŸå› ç©¶æ˜ã§ã™ã€‚ https://services.gradle.org/distributions/ ã¯ã‚ã‚‹ã®ã«ãªãœ404? ã¨æ€ã£ãŸã‚‰ã€<code>http://...</code>ã§å–ã‚Šã«è¡Œã£ã¦ã¾ã—ãŸã€‚gradlewã®gradleãŒå¤ã™ãã‚‹? <code>grainw</code>ã®ã©ã“ã§æ­¢ã¾ã£ã¦ã‚‹ã‹ã€debug printå…¥ã‚Œã¦å‰²ã‚Šå‡ºã™ã¨ã€<code>./gradlew gendeps</code>ã§ã—ãŸã€‚ã“ã‚Œã‚’version 6.8.1ã®gradleã§æ‰‹å‹•ã§ã‚„ã£ã¦ã¿ã‚‹(<code>gradle gendeps</code>)ã¨ã€<code>build.gradle</code>ã®<code>line: 78</code>ã§æ­¢ã¾ã‚Šã¾ã™ã€‚ãªã‚“ã§?ã¨æ€ã£ã¦èª¿ã¹ã‚‹ã¨ã€<a href="https://qiita.com/Yu-s/items/13a6a8db8dc191bb3b42">ã€ŒCannot add task 'wrapper' as a task with that name already exists.ã€ãŒå‡ºãŸ</a>ã«ã‚ã£ãŸé€šã‚Šã€ã§ã—ãŸã€‚</p> <figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='html'><span class='line'>task wrapper(type: Wrapper) {
</span></code></pre></td></tr></table></div></figure> <p>ã‚’</p> <figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='html'><span class='line'>wrapper {
</span></code></pre></td></tr></table></div></figure> <p>ã«ã™ã‚Œã°å‹•ãã¾ã—ãŸã€‚è‰¯ã‹ã£ãŸã€‚ <code>gradle wrapper</code>ã§<code>./gradlew</code>ã‚’æ›´æ–°ã—ã¦ã€<code>./grainw</code>ã‚‚å¾©æ´»ã—ã¾ã—ãŸã€‚</p> </div> </article> <article> <header> <h1 class="entry-title"><a href="/blog/2021/07/11/ansible-for-docker/">Ansible for Docker</a></h1> <p class="meta"> <time datetime="2021-07-11T00:18:00+09:00" pubdate data-updated=true> <span class="month">Jul</span> <span class="day">11</span>, <span class="year">2021</span> </time> | <a href="http://u-ryo.github.io//blog/2021/07/11/ansible-for-docker/#disqus_thread">Comments</a> </p> </header> <div class="entry-content"><p>ansibleã®localã§ã®é–‹ç™ºç’°å¢ƒã¨ã„ãˆã°vagrant+virtualboxã§ã™ãŒã€dockerã§ã„ã„ã‚“ã˜ã‚ƒã­ã‡ã®?ã¨æ€ã£ã¦è‰²ã€…è©¦è¡ŒéŒ¯èª¤ã—ã¦ã¿ã¾ã—ãŸã€‚ä½•åº¦ã‚‚æŒ«ã‘ã¦ã€ã‚‚ã†é§„ç›®ã‹ã¨æ€ã„ã¾ã—ãŸã‘ã©ã€å¹¾ã¤ã‚‚ã®å±±ã‚’è¶Šãˆã€ã¤ã„ã«å‡ºæ¥ã¾ã—ãŸã§ã™ã‚ˆ!</p> <figure class='code'><figcaption><span>docker.ini</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
</pre></td><td class='code'><pre><code class='yaml'><span class='line'><span class="p-Indicator">[</span><span class="nv">docker_host</span><span class="p-Indicator">]</span>
</span><span class='line'><span class="l-Scalar-Plain">localhost</span>
</span><span class='line'>
</span><span class='line'><span class="l-Scalar-Plain">[container]</span>
</span><span class='line'><span class="l-Scalar-Plain">eiger-local</span>
</span></code></pre></td></tr></table></div></figure> <figure class='code'><figcaption><span>playbooks/docker.yml</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
<span class='line-number'>37</span>
<span class='line-number'>38</span>
<span class='line-number'>39</span>
<span class='line-number'>40</span>
<span class='line-number'>41</span>
<span class='line-number'>42</span>
<span class='line-number'>43</span>
<span class='line-number'>44</span>
<span class='line-number'>45</span>
<span class='line-number'>46</span>
<span class='line-number'>47</span>
</pre></td><td class='code'><pre><code class='yaml'><span class='line'><span class="p-Indicator">-</span> <span class="l-Scalar-Plain">hosts</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">localhost</span>
</span><span class='line'>  <span class="l-Scalar-Plain">connection</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">local</span>
</span><span class='line'>  <span class="l-Scalar-Plain">gather_facts</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">no</span>
</span><span class='line'>  <span class="l-Scalar-Plain">vars</span><span class="p-Indicator">:</span>
</span><span class='line'>    <span class="l-Scalar-Plain">ansible_python_interpreter</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">/Users/ryo-umetsu/.anyenv/envs/pyenv/shims/python</span>
</span><span class='line'>    <span class="c1"># ansible_python_interpreter: /usr/bin/python3</span>
</span><span class='line'>  <span class="l-Scalar-Plain">tasks</span><span class="p-Indicator">:</span>
</span><span class='line'>    <span class="p-Indicator">-</span> <span class="l-Scalar-Plain">name</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">deploy amazonlinux docker</span>
</span><span class='line'>      <span class="l-Scalar-Plain">docker_container</span><span class="p-Indicator">:</span>
</span><span class='line'>        <span class="l-Scalar-Plain">image</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">amazonlinux</span>
</span><span class='line'>        <span class="l-Scalar-Plain">name</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">eiger-local</span>
</span><span class='line'>        <span class="l-Scalar-Plain">volumes</span><span class="p-Indicator">:</span>
</span><span class='line'>          <span class="p-Indicator">-</span> <span class="l-Scalar-Plain">/sys/fs/cgroup:/sys/fs/cgroup:ro</span>
</span><span class='line'>        <span class="l-Scalar-Plain">ports</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">57017:27017</span>
</span><span class='line'>        <span class="l-Scalar-Plain">expose</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">57017</span>
</span><span class='line'>        <span class="l-Scalar-Plain">tty</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">yes</span>
</span><span class='line'>        <span class="l-Scalar-Plain">detach</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">yes</span>
</span><span class='line'>        <span class="l-Scalar-Plain">privileged</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">yes</span>
</span><span class='line'>        <span class="c1"># capabilities:</span>
</span><span class='line'>        <span class="c1">#   - SYS_ADMIN</span>
</span><span class='line'>        <span class="c1"># sysctl:</span>
</span><span class='line'>        <span class="c1">#   vm.swappiness: 1</span>
</span><span class='line'>        <span class="l-Scalar-Plain">command</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">sh -c &#39;yum -y install procps systemd-sysv file &amp;&amp; exec /sbin/init &amp;&amp; systemctl restart&#39;</span>
</span><span class='line'>    <span class="p-Indicator">-</span> <span class="l-Scalar-Plain">name</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">adding host</span>
</span><span class='line'>      <span class="l-Scalar-Plain">add_host</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">name=&quot;eiger-local&quot;</span>
</span><span class='line'>    <span class="p-Indicator">-</span> <span class="l-Scalar-Plain">name</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">wait</span>
</span><span class='line'>      <span class="l-Scalar-Plain">wait_for</span><span class="p-Indicator">:</span>
</span><span class='line'>        <span class="l-Scalar-Plain">delay</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">10</span>
</span><span class='line'>        <span class="l-Scalar-Plain">timeout</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">10</span>
</span><span class='line'>
</span><span class='line'><span class="p-Indicator">-</span> <span class="l-Scalar-Plain">hosts</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">eiger-local</span>
</span><span class='line'>  <span class="l-Scalar-Plain">connection</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">docker</span>
</span><span class='line'>  <span class="l-Scalar-Plain">vars</span><span class="p-Indicator">:</span>
</span><span class='line'>    <span class="l-Scalar-Plain">setup_mongodb_password</span><span class="p-Indicator">:</span> <span class="kt">!vault</span> <span class="p-Indicator">|</span>
</span><span class='line'>      <span class="no">$ANSIBLE_VAULT;1.1;AES256</span>
</span><span class='line'>          <span class="no">39356533306331333763353433363335343961653335373762623630653361623034646232633837</span>
</span><span class='line'>          <span class="no">6164306666656436653636643333363261646662356666640a636462346635323164633365376637</span>
</span><span class='line'>          <span class="no">39303832396638336664653439326536386235323262303733653563653766353263623032386538</span>
</span><span class='line'>          <span class="no">3135623166613363630a343734666666323830663838653962663032386337626635396563383230</span>
</span><span class='line'>          <span class="no">6266</span>
</span><span class='line'>    <span class="c1"># setup_mongodb_password: &quot;test&quot;</span>
</span><span class='line'>    <span class="l-Scalar-Plain">ansible_python_interpreter</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">/usr/bin/python</span>
</span><span class='line'>  <span class="l-Scalar-Plain">roles</span><span class="p-Indicator">:</span>
</span><span class='line'>    <span class="p-Indicator">-</span> <span class="l-Scalar-Plain">role</span><span class="p-Indicator">:</span> <span class="s">&quot;../roles/create_data_directory&quot;</span>
</span><span class='line'>    <span class="p-Indicator">-</span> <span class="l-Scalar-Plain">role</span><span class="p-Indicator">:</span> <span class="s">&quot;../roles/setup_mongodb&quot;</span>
</span><span class='line'>    <span class="p-Indicator">-</span> <span class="l-Scalar-Plain">role</span><span class="p-Indicator">:</span> <span class="s">&quot;../roles/configure_logrotate&quot;</span>
</span><span class='line'>    <span class="p-Indicator">-</span> <span class="l-Scalar-Plain">role</span><span class="p-Indicator">:</span> <span class="s">&quot;../roles/configure_swap&quot;</span>
</span></code></pre></td></tr></table></div></figure> <p>å‡„ã„know-howè©°ã¾ã£ã¦ã¾ã™ã€‚</p> <ul> <li><code>connection: local</code>ã¨ã™ã‚‹ã¨<code>ssh</code>çµŒç”±ã˜ã‚ƒãªãç›´æ¥commandå©ã„ã¦ãã‚Œã‚‹</li> <li><code>connection: docker</code>ã¨ã™ã‚‹ã¨<code>docker exec</code>ã§å©ã„ã¦ãã‚Œã‚‹(ã®ã§targetã«<code>authorized_keys</code>ã¨ã‹<code>sshd</code>ã¨ã‹ä¸è¦)</li> <li><code>localhost</code>ã§ã¯<code>gather_facts: no</code>ã¨ã™ã‚‹(ã“ã‚Œã‚’ã—ãªã„ã¨<code>ansible_swaptotal_mb</code>ã¨ã‹<code>ansible_memtotal_mb</code>ã¨ã„ã£ãŸ<a href="https://docs.ansible.com/ansible/2.9_ja/user_guide/playbooks_variables.html#fact">ã‚·ã‚¹ãƒ†ãƒ ã‹ã‚‰æ¤œå‡ºã•ã‚Œã‚‹å¤‰æ•°: Fact (ãƒ•ã‚¡ã‚¯ãƒˆ)</a>ãŒåŸ‹ã‚ã‚‰ã‚Œãªã„)</li> <li><code>ansible_python_interpreter: /usr/bin/python3</code>ã¯<code>python</code> binaryã‚’æ¢ã™é †åºãŒã‚ã£ã¦ã€<code>/usr/bin/python</code>ã‚’å…ˆã«è¦‹ã¤ã‘ã¦ã—ã¾ã„ã€version 2ã‚’ä½¿ã£ã¦ã—ã¾ã†ã®ã‚’é˜²ããŸã‚ã€‚Macã ã¨<code>/usr/bin/python</code>ãŒpython2ã§ã€python3ã¯<code>/usr/bin/python3</code>ãªã®ã§ã€‚ã“ã“ã®versionãŒåˆã‚ãªã„ã¨ã€<code>The error was: No module named 'requests'"</code>ã¨è¨€ã‚ã‚Œã¦ä½•ãŒæ‚ªã„ã®ã‹ã•ã£ã±ã‚Šã ã£ãŸã€‚åŸºæœ¬çš„ã«ã¯<code>pip3 install docker</code>ãŒè¶³ã‚Šãªã‹ã£ãŸã®ã ãŒã€ãã®ä»–ã«ã€ã“ã®ã‚ˆã†ã«ansibleãŒè‡ªåˆ†ã§è¦‹ã¤ã‘ã¦ä½¿ã£ã¦ã„ã‚‹pythonã®versionã¨è‡ªåˆ†ãŒcommand lineã§ä½¿ã£ã¦ã„ã¦<code>pip install</code>ã—ãŸpythonã®versionãŒãšã‚Œã¦ã„ã‚‹ã¨ã€ã“ã®ã‚ˆã†ã«è¨€ã‚ã‚Œã‚‹ã€ã“ã¨ãŒã‚ã‹ã£ãŸã€‚ãã®ä»–ã«ã‚‚inventoryã§æŒ‡å®šã™ã‚‹ã“ã¨ã‚‚command line optionã§æŒ‡å®šã™ã‚‹ã“ã¨ã‚‚å‡ºæ¥ã‚‹ã€‚command line optionã§<code>-e ansible_python_interpreter=/usr/bin/python3</code>ã¨ã™ã‚‹ã®ãŒæœ€ã‚‚æŸ”è»Ÿã ãŒã€ã“ã‚Œã¯playbooksä¸­ã®å€¤ã‚’å…¨ã¦ä¸Šæ›¸ãã™ã‚‹ã®ã§ã€ã‚„ã¯ã‚Šæ³¨æ„ãŒå¿…è¦ã ã£ãŸã€‚pythonã£ã¦versionã‚„ã‚„ã“ã—ãã¦...</li> <li><code>setup_mongodb_password: !vault |</code>ã¯<a href="https://docs.ansible.com/ansible/2.9/user_guide/playbooks_vault.html#single-encrypted-variable">Single Encrypted Variable</a>ã§<code>echo -n test|ansible-vault encrypt_string --vault-password-file vault_password.txt --encrypt-vault-id default --stdin setup_mongodb_password</code>ã®ã‚ˆã†ã«ä½¿ã†(<a href="https://qiita.com/park-jh/items/91bf48848e366c79a61b#variable%E3%82%921%E9%A0%85%E7%9B%AE%E3%81%A0%E3%81%91%E6%9A%97%E5%8F%B7%E5%8C%96%E3%81%99%E3%82%8B">ansible-vaultã§æš—å·åŒ–ã—ã‚ˆã†ã€‚</a>)</li> <li><code>docker_container:</code>ã¯moduleåã§ã€å¤ã„æ–‡çŒ®ã ã¨<code>docker:</code>ã«ãªã£ã¦ã„ã¦ä»Šã¯åŠ¹ã‹ãªã„ã®ã§æ³¨æ„ã€‚ä¸­ã§æŒ‡å®šã§ãã‚‹ã‚‚ã®ã¯<a href="https://docs.ansible.com/ansible/latest/collections/community/docker/docker_container_module.html#ansible-collections-community-docker-docker-container-module">community.docker.docker_container â€“ manage docker containers</a>ã«æŒ™ãŒã£ã¦ã„ã‚‹ã€‚<code>privileged: yes</code>ã¯ã€containerå†…ã§<code>sysctl vm.swappiness=1</code>(defaultã¯60)ã‚’ã•ã‚Œã‚‹ã®ã§ã€‚<code>sysctl:</code>ã¨ã„ã†optionã‚‚ã‚ã‚‹ã®ã ã‘ã‚Œã©ã€ãã“ã§æŒ‡å®šã§ãã‚‹(whitelistã«ã‚ã‚‹)ã®ã¯<code>net.*</code>ã¨ã‹<code>kernel.*</code>ã®ä¸€éƒ¨ã ã‘ã ãã†(<a href="https://docs.docker.jp/engine/reference/commandline/run.html#currently-supprted-sysctls">ã‚µãƒãƒ¼ãƒˆä¸­ã® sysctl</a>)ã€‚</li> <li><code>command: sh -c 'yum -y install procps systemd-sysv file &amp;&amp; exec /sbin/init'</code>ã¯ã€playbookä¸­ã§<code>systemctl</code>ã‚’è¨­å®šã™ã‚‹ã‚‚ã®ãŒã‚ã‚‹ã‹ã‚‰ã€‚<code>Restart=always</code>ã«ã—ãŸã„ã‚“ã§ã™ã‚ˆã­è¦ã™ã‚‹ã«ã€‚ã§ã‚‚ã€ãã†ã™ã‚‹ã¨dockerã«<code>systemd</code>(<code>initd</code>)ãŒå‹•ã„ã¦ã„ã­ã°ãªã‚‰ãšã€ãã†ã„ãˆã°dockerã£ã¦æ™®é€šã¯ãã‚“ãªã®ãªã‹ã£ãŸãªã€ã©ã†ã‚„ã‚‹ã‚“ã ? <a href="https://qiita.com/mach3/items/33f2b234babe679c759f">èª¿ã¹ã‚‹</a>ã¨ã€</li> <li><code>systemd-sysv</code>ã‚’installã™ã‚‹å¿…è¦</li> <li><code>/sys/fs/cgroup:/sys/fs/cgroup:ro</code>ã®device mountãŒå¿…è¦<ul> <li>macã«ã¯ãã‚“ãªdirectoryã¯ãªã„ã®ã«å¤§ä¸ˆå¤«ãªã®ãŒä¸æ€è­°</li> </ul> </li> <li>æœ€å¾Œã¯<code>/sbin/init</code></li> <li>â†‘ã“ã‚Œã§ã¯containerãŒæ•°ç§’ã§å€’ã‚Œã‚‹ã®ã§æ›´ã«èª¿ã¹ã‚‹ã¨<code>exec /sbin/init</code>(ã“ã‚Œã©ã“ã§è¦‹ãŸã‚“ã ã£ã‘ãªãæ„Ÿå‹•ã—ãŸãªãStackOverflowã ã£ãŸæ°—ãŒã€‚ä»–ã§ã¯å…¨ç„¶æ›¸ã„ã¦ç„¡ãã¦ã€ã‚ˆãè¦‹ã¤ã‘ãŸã‚‚ã‚“ã )</li> <li><code>wait_for:</code>ãŒãªã„ã¨ã€dockerå†…ã«ã¾ã <code>yum install</code>ã¨ã‹çµ‚ã‚ã‚Šãã£ã¦ãªã„ã®ã«ã©ã‚“ã©ã‚“æ¬¡ã«é€²ã‚“ã§ã—ã¾ã„ã€<code>service.name:mongod,service.enabled:true</code>ã®æ™‚ã«ã€Œ<code>mongod</code>ã¨ã„ã†serviceã¯ãªã„ã€ã¨ã„ã£ã¦è½ã¡ã¦ã—ã¾ã†ã®ã§ã€‚ãƒ›ãƒ³ãƒˆã¯ã¡ã‚ƒã‚“ã¨ä½•ã‹ã‚’å¾…ã¡ãŸã‹ã£ãŸã‚“ã ã‘ã©ã€ä½•ã‚’å¾…ã£ãŸã‚‰ã„ã„ã®ã‹ä¸æ˜ã§ã—ãŸã€‚processã‹ãªã¨æ€ã£ãŸã‚“ã§ã™ãŒã€processã®waitã£ã¦<a href="https://www.middlewareinventory.com/blog/ansible-wait_for-examples/">pid fileã®å­˜åœ¨æœ‰ç„¡ã‚’ç¢ºèªã™ã‚‹</a>ã¿ãŸã„ãªã€‚ã„ã‚ƒãƒ¼ã€<code>systemd</code>ã¨ã„ã†ã‹<code>init</code>ã£ã¦pid fileãªã‚“ã¦ãªã„ã‚“ã§ã™ã‘ã©ã€‚network portå¾…ã¤ä¾‹ã¯æ•°å¤šã‚ã‚Œã©ã€‚ä»•æ–¹ãªã„ã®ã§ãŸã 10ç§’å¾…ã¤ã‚ˆã†ã«ã€‚<code>timeout:10</code>ã¯ä¸è¦ã‹ã¨æ€ã„ãã‚„ã€ãªã„ã¨ãšã£ã¨å¾…ã£ã¦ã¾ã—ãŸã€‚</li> <li>ã“ã‚Œã‚’<code>ansible-playbook -vvv -i docker.ini playbooks/docker.yml</code>ã¨å®Ÿè¡Œã™ã‚‹ã‚“ã§ã™ãŒã€dockerã§ã‚„ã‚‹å ´åˆã¯<code>ansible/ansible-runner</code>ä½¿ã£ã¦ã€<code>docker run --rm --name=ansible -v $PWD:/work -w /work -v /var/run/docker.sock:/var/run/docker.sock ansible/ansible-runner sh -c 'pip3 install docker&amp;yum install -y yum-utils;yum-config-manager --add-repo https://download.docker.com/linux/centos/docker-ce.repo;yum install -y docker-ce docker-ce-cli containerd.io;ansible-playbook -i docker.ini playbooks/docker.yml'</code>ã¨ã€CentOS8 baseã®ansible-runnerã«dockerã‚’å…¥ã‚Œã­ã°ãªã‚‰ãšã€ã¾ãŸunix socketã‚’å…±æœ‰ã—ãªã„ã¨ãªã‚Šã¾ã›ã‚“ã§ã—ãŸã€‚CentOS8ã«<code>yum install docker</code>ã™ã‚‹ã¨podmanãŒå…¥ã‚Šã‚„ãŒã‚‹ã‚“ã§ã™ã‚ˆã­ã€‚podmanã£ã¦Macã˜ã‚ƒå‹•ã‹ã­ã‡ã£ã¤ãƒ¼ã®! podmanã ã¨<code>hosts:eiger-local</code>ã®<code>gather_facts</code>ã§Docker version checkã«å¤±æ•—ã—ã¦è½ã¡ã‚‹ã‚“ã§ã™ã‚ˆã­ã€‚<a href="https://discussion.fedoraproject.org/t/podman-broken-on-silverblue-podman-complains-kernel-not-supporting-overlay-fs-backing-file-system-is-unsupported-for-this-graph-driver/25403/2">Podman broken on Silverblue? Podman complains kernel not supporting overlay fs (backing file system is unsupported for this graph driver)</a>è¦‹ã¦<code>sed -i "s/#mount_program/mount_program/" /etc/containers/storage.conf</code>åŠ ãˆã¦ã‚‚ã€<code>Error: mount /var/lib/containers/storage/overlay:/var/lib/containers/storage/overlay, flags: 0x1000: operation not permitted</code>ã€‚ã†ãƒ¼ã‚“ã€‚é€†ã«ã€docker containerã«ansibleã‚’å…¥ã‚Œã‚‹æ–¹ãŒsimpleã§ã—ãŸã€‚å³ã¡ã€<code>docker run --rm --name=ansible -v $PWD:/work -w /work -v /var/run/docker.sock:/var/run/docker.sock docker sh -c 'apk add ansible py3-pip;pip3 install docker;ansible-playbook -i docker.ini playbooks/docker.yml'</code>ã§ã™ã­ã€‚</li> </ul> <h2>å‚è€ƒã‚µã‚¤ãƒˆ</h2> <ul> <li><a href="https://techblog.gmo-ap.jp/2016/09/23/docker%E3%82%92%E4%BD%BF%E3%81%A3%E3%81%A6%E3%82%B3%E3%83%B3%E3%83%86%E3%83%8A%E3%82%92ansible%E3%81%A7%E3%83%97%E3%83%AD%E3%83%93%E3%82%B8%E3%83%A7%E3%83%8B%E3%83%B3%E3%82%B0%E3%81%97%E3%81%9F/">ansibleã‚’ä½¿ã£ã¦Dockerã‚³ãƒ³ãƒ†ãƒŠã‚’ãƒ—ãƒ­ãƒ“ã‚¸ãƒ§ãƒ‹ãƒ³ã‚°ã—ãŸãŠè©±</a></li> <li><a href="https://qiita.com/gosarami/items/e1600292aa260444d3df">ansible-playbookã§dockerã‚³ãƒ³ãƒ†ãƒŠã‚’ãƒ—ãƒ­ãƒ“ã‚¸ãƒ§ãƒ‹ãƒ³ã‚°ã—ã¦ã¿ãŸ</a></li> <li><a href="https://inamuu.com/ansible%E3%81%A7docker%E3%81%B8%E3%83%97%E3%83%AD%E3%83%93%E3%82%B8%E3%83%A7%E3%83%8B%E3%83%B3%E3%82%B0%E3%81%99%E3%82%8B/">Ansibleã§dockerã¸ãƒ—ãƒ­ãƒ“ã‚¸ãƒ§ãƒ‹ãƒ³ã‚°ã™ã‚‹</a></li> <li><a href="https://techblog.gmo-ap.jp/wp-content/uploads/2016/09/77a5ba13cea567e2af8323cbfa5a2286.pdf">ansibleã‚’ä½¿ã£ã¦Dockerã‚³ãƒ³ãƒ†ãƒŠã‚’ãƒ—ãƒ­ãƒ“ã‚¸ãƒ§ãƒ‹ãƒ³ã‚°ã™ã‚‹</a></li> <li><a href="https://docs.ansible.com/ansible/latest/collections/community/docker/docker_container_module.html#ansible-collections-community-docker-docker-container-module">community.docker.docker_container â€“ manage docker containers</a></li> <li><a href="https://rheb.hatenablog.com/entry/ansible_interpreter_discovery">Ansible2.8ã®æ–°æ©Ÿèƒ½1 - Interpreter Discovery</a></li> <li><a href="https://qiita.com/muddydixon/items/d2982ab0846002bf3ea8">Docker privileged ã‚ªãƒ—ã‚·ãƒ§ãƒ³ã«ã¤ã„ã¦</a></li> <li><a href="https://qiita.com/osamunmun/items/1786aac5904439522d72">Dockerã‚³ãƒ³ãƒ†ãƒŠä¸Šã§sysctlã§ã‚«ãƒ¼ãƒãƒ«ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ã‚’å¤‰æ›´ã™ã‚‹æ–¹æ³•</a></li> <li><a href="https://docs.docker.jp/engine/reference/commandline/run.html#currently-supprted-sysctls">ã‚µãƒãƒ¼ãƒˆä¸­ã® sysctl</a></li> <li><a href="https://qiita.com/ma2shita/items/f1a68a3f909c5cee7869">Dockerã‚³ãƒ³ãƒ†ãƒŠå†…ã®net.core.somaxconnã‚’ã„ã˜ã‚‹æ–¹æ³•</a></li> <li><a href="https://blog.ymyzk.com/2017/01/docker-compose-sysctls/">Docker Compose ã§ã‚«ãƒ¼ãƒãƒ«ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ã‚’è¨­å®šã™ã‚‹</a></li> <li><a href="https://moznion.hatenadiary.com/entry/2018/09/01/224626">Linux Kernel 4.12ä»¥å‰ã§ã‚ã‚Œã°hostãƒã‚·ãƒ³ã®sysctlã®å€¤ãŒDocker containerç’°å¢ƒã«å¼•ãç¶™ãŒã‚Œã‚‹ã‹ã©ã†ã‹æ¤œè¨¼ã—ãŸ</a></li> <li><a href="https://qiita.com/hiroyuki_onodera/items/398c1331b157e5b4b588">Ansible: ã‚¿ãƒ¼ã‚²ãƒƒãƒˆãƒãƒ¼ãƒ‰ã§python3ã‚’ä½¿ç”¨ã™ã‚‹ansible.cfgè¨­å®šã¯ã€ansible<em>python</em>interpreterã§ã¯ç„¡ãinterpreter_python</a></li> <li><a href="https://kamatama41.hatenablog.com/entry/2019/06/17/001009">Dockerã®Ubuntuã‚³ãƒ³ãƒ†ãƒŠã§systemdã‚’å‹•ã‹ã™</a></li> <li><a href="https://qiita.com/mach3/items/33f2b234babe679c759f">Docker amazonlinux2 ã§ systemctl ã‚’ä½¿ã„ãŸã„äººç”Ÿã ã£ãŸ</a></li> <li><a href="https://qiita.com/kawanet/items/d856b7b9eb8ceccac4d7">Docker for Macã§Amazon Linux 2ã§systemd</a></li> <li><a href="https://www.middlewareinventory.com/blog/ansible-wait_for-examples/">Ansible wait_for module examples</a></li> </ul> </div> </article> </article> <div class="pagination"> <div class="links"> <a class="archive" href="/archives/">Blog Archives</a> <a class="next" href="/page/2/">Older &rarr;</a> </div> </div> </div> <aside class="sidebar"> <section> <h1>Recent Posts</h1> <ul id="recent_posts"> <li class="post"> <a href="/blog/2023/09/10/get-refresh-token-for-google-api/">Get Refresh Token for Google API</a> </li> <li class="post"> <a href="/blog/2023/09/10/get-refresh-token-for-google-api/">Get Refresh Token for Google API</a> </li> <li class="post"> <a href="/blog/2022/03/20/nhk-taiga-staff-reflection/">NHK Taiga Staff Reflection</a> </li> <li class="post"> <a href="/blog/2021/07/11/gradlew-stopped/">Gradlew Stopped</a> </li> <li class="post"> <a href="/blog/2021/07/11/ansible-for-docker/">Ansible for Docker</a> </li> </ul> </section> <section> <h1>GitHub Repos</h1> <a href="https://github.com/u-ryo">u-ryo</a> on GitHub </section> <section> <h1>About Me</h1> <p>A ~~Java~~ Ruby programmer in Tokyo.</p> </section> <section> <h1><a href="privacy.html">Privacy Policy</a></h1> </section> </aside> </div> </div> <footer role="contentinfo"><p> Copyright &copy; 2023 - u-ryo - <span class="credit">Powered by <a href="http://sysgears.com/grain/">Grain</a></span> </p> </footer> <script type="text/javascript">
  var disqus_shortname = "uryooo";
  
    // As `page.comments` is empty, we must be on the index page.
    var disqus_script = 'count.js';
  
  (function () {
    var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
    dsq.src = 'http://' + disqus_shortname + '.disqus.com/' + disqus_script;
    (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
  }());
</script> <div id="fb-root"></div> <script>
    (function(d, s, id) {
      var js, fjs = d.getElementsByTagName(s)[0];
      if (d.getElementById(id)) {return;}
      js = d.createElement(s); js.id = id; js.async = true;
      js.src = "//connect.facebook.net/en_US/all.js#appId=212934732101925&xfbml=1";
      fjs.parentNode.insertBefore(js, fjs);
      }(document, 'script', 'facebook-jssdk'));
  </script> <script type="text/javascript">
    (function() {
      var script = document.createElement('script'); script.type = 'text/javascript'; script.async = true;
      script.src = 'https://apis.google.com/js/plusone.js';
      var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(script, s);
    })();
  </script> <script type="text/javascript">
    (function(){
      var twitterWidgets = document.createElement('script');
      twitterWidgets.type = 'text/javascript';
      twitterWidgets.async = true;
      twitterWidgets.src = 'http://platform.twitter.com/widgets.js';
      document.getElementsByTagName('head')[0].appendChild(twitterWidgets);
    })();
  </script> </body> </html>